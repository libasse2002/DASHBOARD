-- Création de la base de données
CREATE DATABASE IF NOT EXISTS polytechd;
USE polytechd;

-- Création de la table utilisateur2
CREATE TABLE utilisateur2 (
    id INT AUTO_INCREMENT PRIMARY KEY,
    username VARCHAR(100) NOT NULL,
    email VARCHAR(100) UNIQUE NOT NULL,
    password VARCHAR(255) NOT NULL,
    role ENUM('enseignant', 'admin') DEFAULT 'enseignant'
);

-- Création de la table departements
CREATE TABLE departements (
    id INT AUTO_INCREMENT PRIMARY KEY,
    nom VARCHAR(100) NOT NULL
);

-- Création de la table fiches
CREATE TABLE fiches (
    id INT AUTO_INCREMENT PRIMARY KEY,
    utilisateur_id INT NOT NULL,
    departement_id INT NOT NULL,
    nom_ec VARCHAR(150) NOT NULL,
    hours_cm FLOAT,
    hours_td FLOAT,
    hours_tp FLOAT,
    date DATE NOT NULL,
    signature VARCHAR(255) NOT NULL,
    statut ENUM('en_attente', 'validée', 'refusée') DEFAULT 'en_attente',
    date_creation TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    date_modification TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (utilisateur_id) REFERENCES utilisateur2(id) ON DELETE CASCADE,
    FOREIGN KEY (departement_id) REFERENCES departements(id) ON DELETE CASCADE
);
